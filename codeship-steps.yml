- name: test
  type: serial
  services:
    - dmk-python2.7
    - dmk-python3.5
    - dmk-python3.6
  steps:
    - command: py.test


- name: deploy-dockerhub
  type: push
  service: dmk-deploy-img
  tag: '^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)((a|rc|b)(0|[1-9]\d*))?$' # PEP440 version tags
  image_name: avirshup/docker-make
  image_tag: "{{.Branch}}"
  registry: https://index.docker.io/v1


- name: deploy-pypi
  service: dmk-deploy-img
  command: deploy.sh
  tag: '^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)((a|rc|b)(0|[1-9]\d*))?$' # PEP440 version tags
